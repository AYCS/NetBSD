VERSION: :1,$s/2014-05-10/2014-05-10/g
ISO:     :1,$s/201405081300Z/201405081300Z/g
PKGSRC:  :1,$s/2014-05-03/2014-05-03/g
NetBSD:  :1,$s/6.99.41/6.99.41/g

To: port-armNetBSD.org@localhost
Subject: 2014-05-10-netbsd-raspi.img (Re: Raspberry Pi update please.)
From: Jun Ebihara <jun@soum.co.jp>

I've updated 2014-05-10-netbsd-raspi.img.gz for RPI.

ftp://ftp.netbsd.org/pub/NetBSD/misc/jun/raspberry-pi/2014-05-10-earmhf/2014-05-10-netbsd-raspi.img.gz

Update:
- NetBSD-current 6.99.41 evbarm-earmhf 201405081300Z from nyftp
- pkgsrc-current         2014-05-03 tarball from ftp.NetBSD
- openssl-1.0.1g support,fixed OpenSSL NetBSD-SA2014-004 on NetBSD and pkgsrc.
- This is hardfloat image: build with earmhf
   softfloat: 2013-09-09-02-netbsd-evbarm.img.gz  evbarm (02:firmupdate) 
>> hardfloat: 2014-05-10-netbsd-raspi.img.gz      earmhf

Pre-compiled packages:
- Pre-compiled packages path setting: see /etc/pkg_install.conf 
PKG_PATH=ftp://ftp.netbsd.org/pub/NetBSD/misc/jun/raspberry-pi/earmhf/2014-05-10/
 To install application.
 # pkg_add some_application_name

 If you update pkgsrc by yourself,comment out /etc/pkg_install.conf and check
 /etc/mk.conf.

Sharp NetWalker special kernel: (Thanx h_kenken@)
  /boot/netbsd-NETWALKER.bin.gz is a kernel for Sharp NetWalker.

  1. Make backup image on NetWalker ubuntu.
  2. cp /boot/netbsd-netwalker.bin.gz [BackupImage]/boot/zImage
  3. Set [BackupImage] MicroSD to NetWalker MicroSD port
  4. Set RPI image to USB port via SD to USB dongle.
  5. With pushing [L Mouse][R Mouse],push Power button in 5 seconds.
  6. Pray for success in 5 seconds.
  7. Typical NetBSD Boot message appears on your console.
  8. Fail on single user mode,"mount /"
  9. vi /etc/fstab and type :1,$s/ld0/sd0/g w q
  10. reboot and login again.
  11. startx and mouse can control with small touchpad.

musica - DLNA/UPnP music server: (Thanx @cvsync)
 MAEKAWA Masahide make a DLNA/UPnP music server called "musica".
 
  1. Check http://www.m-systems.co.jp/musica/index_en.html .
  2. Download musica-0.1.16-netbsd6-evbarm-earmhf.tar.gz for evaluation.
  3. Extract tar file and read documents.
  4. ./musica -d [AAC,MP3,WMA,FLAC,DSDIFF,DSF,AIFF,WAV,Apple Lossless dir]
  5. Find from DLNA/UPnP AV equipment.
  6. With a little luck,you'll find musica and enjoy music via musica.
  7. If you feel slow,Try {NetBSD/amd64 i386,OSX,Ubuntu} Version or improve NetBSD.

Todo:
- Need GPIO & bus controll document and implimentation (via lua?)
- comment out kernel DEBUG/DIAGNOSTIC option
- DTRACE http://wiki.netbsd.org/tutorials/how_to_enable_and_run_dtrace/

=====================

For OpenSourceUnConference 2014 Kawagoe NetBSD booth
(https://www.facebook.com/events/1465786260321905/)
demonstration use, I've updated raspberry-pi image.

- NetBSD 6.99.41 earmhf rpi.img.gz base
- Connect HDMI,USB Keyboard,USB Mouse,Ether(dhcpd and ntpd will work)
- login root (no passwd)
- startx ,and icewm running.
  twitter client (net/mikutter) on 40inch home TV.
  http://movapic.com/pic/2013061822184751c05e37e612e
- running mikutter.
  # startx
  # dillo &
  # mikutter &
  copy twitter auth URL and paste into dillo URL bar.
  -> get pin number.
  -> paste pin number to mikutter
  ==== one or two or threee moment =====
  Get your twitter timeline with your family!

Features:
  - fit size for 2GB SD Card
  - with X11
  - increase more inodes on /dev/ld0a
  - Recent current RPI kernel
  - USB/video support: as -current (video needs more tests)
  - pkgsrc: 2014-05-03 tree inside.
  - pre-build packages
    ftp://ftp.netbsd.org/pub/NetBSD/misc/jun/raspberry-pi/earmhf/2014-05-10/

Installed Packages:
kterm
tcsh
vlgothic-ttf
icewm
xli
mikutter
medit
uim
fossil
raspberrypi-userland
sudo
git-base
zsh
dillo
mlterm
pkg_chk
lintpkgsrc

To control HDMI output,add/delete "console=fb" on cmdline.txt.
If delete console=fb definition,you can get serial console instead.
 rpi$ more /boot/cmdline.txt
 root=ld0a console=fb

Keyboard layout checkpoint:
/etc/wscons.conf
 #encoding sv
 #encoding us.swapctrlcaps
 encoding jp

/root/.xinitrc
 setxkbmap -model jp106 jp

Build sample script:
 https://github.com/ebijun/NetBSD/tree/master/RPI/RPIimage/Image

Guide:
 https://github.com/ebijun/NetBSD/blob/master/Guide/RPI.rst

BUGS:
1. dillo crashes at startup
 this image contains dillo with patch by Michael van Elst
 http://mail-index.netbsd.org/port-arm/2014/04/22/msg002386.html

Fixed: 
1. Cannot input Japanese special keys of JP106 keyboard with NetBSD/evbarm(RPI) or some arch. (sample binary replaced in this image)
 xsrc/48347: (thanx christos!)
 http://gnats.netbsd.org/cgi-bin/query-pr-single.pl?number=48347

One more time: (we're gonna celebrate

 1. login root
 2. mlterm-fb 
 3. ftp http://mlterm.sf.net/vimperator.six
 4. cat vimperator.six
 5. exit 
 6. mlterm-fb --rotate=left
 7. cat vimperator.six

--
Jun Ebihara
